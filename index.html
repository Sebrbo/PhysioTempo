<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PhysioTempo</title>
  <link rel="stylesheet" href="css/style.css" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#0b0d12" />
  <link rel="icon" href="icons/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
</head>
<body>
  <main class="container">
    <header class="topbar">
      <h1>PhysioTempo</h1>
      <div class="lang">
        <label for="langSelect" class="i18n" data-key="language">Langue</label>
        <select id="langSelect" aria-label="Langue">
          <option value="en">English</option>
          <option value="fr" selected>Français</option>
        </select>
      </div>
    </header>

    <section class="card">
      <!-- Sélecteur de mode -->
      <div class="mode-row">
        <label>
          <span class="i18n" data-key="mode_label">Cadence</span>
          <select id="mode">
            <option value="accel" class="i18n" data-key="mode_accel">Cadence progressive</option>
            <option value="steady" class="i18n" data-key="mode_steady">Cadence fixe (durée)</option>
            <option value="random" class="i18n" data-key="mode_random">Cadence aléatoire</option>
          </select>
        </label>
      </div>

      <!-- Panneaux de paramètres par mode -->
      <div class="grid">
        <!-- Cadence progressive -->
        <fieldset class="mode-panel" data-mode="accel">
          <legend class="i18n" data-key="mode_accel">Cadence progressive</legend>

          <label>
            <span class="i18n" data-key="start_bpm_label">Cadence de départ (bpm)</span>
            <div class="with-unit">
              <input id="startBpm" type="number" min="20" max="300" step="1" value="40" />
              <span class="unit">bpm</span>
            </div>
          </label>

          <label>
            <span class="i18n" data-key="end_bpm_label">Cadence d’arrivée (bpm)</span>
            <div class="with-unit">
              <input id="endBpm" type="number" min="20" max="300" step="1" value="50" />
              <span class="unit">bpm</span>
            </div>
          </label>

          <label>
            <span class="i18n" data-key="ramp_label">Durée d’accélération (s)</span>
            <input id="rampSeconds" type="number" min="0" max="3600" step="1" value="120" />
          </label>
        </fieldset>

        <!-- Cadence fixe (durée) -->
        <fieldset class="mode-panel hidden" data-mode="steady">
          <legend class="i18n" data-key="mode_steady">Cadence fixe (durée)</legend>

          <label>
            <span class="i18n" data-key="steady_bpm_label">Cadence (bpm)</span>
            <div class="with-unit">
              <input id="steadyBpm" type="number" min="20" max="300" step="1" value="40" />
              <span class="unit">bpm</span>
            </div>
          </label>

          <label>
            <span class="i18n" data-key="steady_secs_label">Durée (s)</span>
            <input id="steadySeconds" type="number" min="1" max="3600" step="1" value="30" />
          </label>
        </fieldset>

        <!-- Cadence aléatoire (durée) -->
        <fieldset class="mode-panel hidden" data-mode="random">
          <legend class="i18n" data-key="mode_random">Cadence aléatoire</legend>

          <label>
            <span class="i18n" data-key="random_min_bpm_label">Cadence min (bpm)</span>
            <div class="with-unit">
              <input id="minBpm" type="number" min="20" max="300" step="1" value="20" />
              <span class="unit">bpm</span>
            </div>
          </label>

          <label>
            <span class="i18n" data-key="random_max_bpm_label">Cadence max (bpm)</span>
            <div class="with-unit">
              <input id="maxBpm" type="number" min="20" max="300" step="1" value="30" />
              <span class="unit">bpm</span>
            </div>
          </label>

          <label>
            <span class="i18n" data-key="random_secs_label">Durée (s)</span>
            <input id="randomSeconds" type="number" min="1" max="3600" step="1" value="90" />
          </label>
        </fieldset>

        <!-- Volume (commun) -->
        <label class="volume">
          <span class="i18n" data-key="volume_label">Volume</span>
          <input id="volume" type="range" min="0" max="100" value="60" />
        </label>
      </div>

      <div class="buttons">
        <button id="preset" class="ghost">
          <span class="i18n" data-key="preset">Préréglage 40 → 50 en 120 s</span>
        </button>
        <div class="spacer"></div>
        <button id="startBtn" class="primary">
          <span class="i18n" data-key="start">Démarrer</span>
        </button>
        <button id="stopBtn" class="danger" disabled>
          <span class="i18n" data-key="stop">Arrêter</span>
        </button>
      </div>

      <div class="readout">
        <div>
          <small class="muted i18n" data-key="current_bpm">Cadence actuelle (bpm)</small>
          <div id="bpmNow" class="mono big">—</div>
        </div>
        <div>
          <small class="muted i18n" data-key="status">Statut</small>
          <div id="status" class="mono">au repos</div>
        </div>
        <div>
          <small class="muted i18n" data-key="time_left">Temps restant</small>
          <div id="timeLeft" class="mono">—</div>
        </div>
      </div>

      <p class="hint i18n" data-key="hint">
        Cadence progressive : rampe linéaire jusqu’à la cadence d’arrivée. Cadence fixe (durée) : cadence constante pendant le temps défini.
        Cadence aléatoire : chaque battement utilise une cadence tirée entre min et max pendant la durée.
      </p>
    </section>

    <footer class="foot">
      <span class="muted">&copy; 2025 PhysioTempo</span>
    </footer>
  </main>

  <script src="js/app.js"></script>

  <!-- PWA: enregistrement du service worker -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("service-worker.js").catch(console.error);
      });
    }
  </script>
</body>
</html>
