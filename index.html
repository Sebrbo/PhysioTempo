<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PhysioTempo</title>
  <link rel="stylesheet" href="css/style.css" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#0b0d12" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="icon" href="icons/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
</head>
<body>
  <main class="container">
    <header class="topbar">
      <h1>PhysioTempo</h1>
      <div class="lang">
        <label for="langSelect" class="i18n" data-key="language">Langue</label>
        <select id="langSelect" aria-label="Langue">
          <option value="en">English</option>
          <option value="fr" selected>Français</option>
        </select>
      </div>
    </header>

    <section class="card">
      <!-- Sélecteur de mode -->
      <div class="mode-row">
        <label>
          <span class="i18n" data-key="mode_label">Cadence</span>
          <select id="mode">
            <option value="accel"     class="i18n" data-key="mode_accel">Cadence progressive</option>
            <option value="steady"    class="i18n" data-key="mode_steady">Cadence fixe (durée)</option>
            <option value="random"    class="i18n" data-key="mode_random">Cadence aléatoire</option>
            <option value="ecc"       class="i18n" data-key="mode_ecc">Excentrique (séries × reps)</option>
            <option value="hsr"       class="i18n" data-key="mode_hsr">HSR (séries × reps)</option>
          </select>
        </label>
      </div>

      <!-- Panneaux de paramètres par mode -->
      <div class="grid">
        <!-- Cadence progressive -->
        <fieldset class="mode-panel" data-mode="accel">
          <legend class="i18n" data-key="mode_accel">Cadence progressive</legend>

          <label>
            <span class="i18n" data-key="start_bpm_label">Cadence de départ (bpm)</span>
            <div class="with-unit">
              <input id="startBpm" type="number" min="20" max="300" step="1" value="40" />
              <span class="unit">bpm</span>
            </div>
          </label>

          <label>
            <span class="i18n" data-key="end_bpm_label">Cadence d’arrivée (bpm)</span>
            <div class="with-unit">
              <input id="endBpm" type="number" min="20" max="300" step="1" value="50" />
              <span class="unit">bpm</span>
            </div>
          </label>

          <label>
            <span class="i18n" data-key="ramp_label">Durée d’accélération (s)</span>
            <input id="rampSeconds" type="number" min="0" max="3600" step="1" value="120" />
          </label>
        </fieldset>

        <!-- Cadence fixe -->
        <fieldset class="mode-panel hidden" data-mode="steady">
          <legend class="i18n" data-key="mode_steady">Cadence fixe (durée)</legend>

          <label>
            <span class="i18n" data-key="steady_bpm_label">Cadence (bpm)</span>
            <div class="with-unit">
              <input id="steadyBpm" type="number" min="20" max="300" step="1" value="40" />
              <span class="unit">bpm</span>
            </div>
          </label>

          <label>
            <span class="i18n" data-key="steady_secs_label">Durée (s)</span>
            <input id="steadySeconds" type="number" min="1" max="3600" step="1" value="30" />
          </label>
        </fieldset>

        <!-- Cadence aléatoire -->
        <fieldset class="mode-panel hidden" data-mode="random">
          <legend class="i18n" data-key="mode_random">Cadence aléatoire</legend>

          <label>
            <span class="i18n" data-key="random_min_bpm_label">Cadence min (bpm)</span>
            <div class="with-unit">
              <input id="minBpm" type="number" min="20" max="300" step="1" value="20" />
              <span class="unit">bpm</span>
            </div>
          </label>

          <label>
            <span class="i18n" data-key="random_max_bpm_label">Cadence max (bpm)</span>
            <div class="with-unit">
              <input id="maxBpm" type="number" min="20" max="300" step="1" value="30" />
              <span class="unit">bpm</span>
            </div>
          </label>

          <label>
            <span class="i18n" data-key="random_secs_label">Durée (s)</span>
            <input id="randomSeconds" type="number" min="1" max="3600" step="1" value="90" />
          </label>
        </fieldset>

        <!-- Excentrique -->
        <fieldset class="mode-panel hidden" data-mode="ecc">
          <legend class="i18n" data-key="mode_ecc">Excentrique (séries × reps)</legend>

          <label>
            <span class="i18n" data-key="ecc_sets_label">Séries</span>
            <input id="eccSets" type="number" min="1" max="20" step="1" value="3" />
          </label>

          <label>
            <span class="i18n" data-key="ecc_reps_label">Répétitions par série</span>
            <input id="eccReps" type="number" min="1" max="50" step="1" value="15" />
          </label>

          <label>
            <span class="i18n" data-key="ecc_work_label">Temps d’effort excentrique (s)</span>
            <input id="eccWorkSec" type="number" min="1" max="15" step="1" value="6" />
          </label>

          <label>
            <span class="i18n" data-key="ecc_return_label">Retour à la position de départ (s)</span>
            <input id="eccReturnSec" type="number" min="0" max="15" step="1" value="3" />
          </label>
        </fieldset>

        <!-- HSR -->
        <fieldset class="mode-panel hidden" data-mode="hsr">
          <legend class="i18n" data-key="mode_hsr">HSR (séries × reps)</legend>

          <label>
            <span class="i18n" data-key="hsr_sets_label">Séries</span>
            <input id="hsrSets" type="number" min="1" max="20" step="1" value="3">
          </label>

          <label>
            <span class="i18n" data-key="hsr_reps_label">Répétitions par série</span>
            <input id="hsrReps" type="number" min="1" max="50" step="1" value="15">
          </label>

          <label>
            <span class="i18n" data-key="hsr_con_label">Concentrique (s)</span>
            <input id="hsrConSec" type="number" min="1" max="15" step="1" value="3">
          </label>

          <label>
            <span class="i18n" data-key="hsr_ecc_label">Excentrique (s)</span>
            <input id="hsrEccSec" type="number" min="1" max="15" step="1" value="3">
          </label>

          <label>
            <span class="i18n" data-key="hsr_hold_top_label">Pause en haut (s)</span>
            <input id="hsrHoldTop" type="number" min="0" max="10" step="1" value="0">
          </label>

          <label>
            <span class="i18n" data-key="hsr_hold_bottom_label">Pause en bas (s)</span>
            <input id="hsrHoldBottom" type="number" min="0" max="10" step="1" value="0">
          </label>

          <label>
            <span class="i18n" data-key="hsr_rep_rest_label">Repos entre répétitions (s)</span>
            <input id="hsrRepRest" type="number" min="0" max="20" step="1" value="0">
          </label>

          <label>
            <span class="i18n" data-key="hsr_rest_label">Repos entre séries (s)</span>
            <input id="hsrRest" type="number" min="0" max="600" step="5" value="120">
          </label>
        </fieldset>

        <!-- Options communes -->
        <fieldset class="mode-panel common">
          <legend class="i18n" data-key="start_options">Démarrage & cycles</legend>

          <label class="row">
            <input id="autoRestart" type="checkbox" />
            <span class="i18n" data-key="auto_restart_label">Redémarrage automatique</span>
          </label>

          <label>
            <span class="i18n" data-key="auto_restart_delay_label">Délai de redémarrage (s)</span>
            <input id="autoRestartDelay" type="number" min="1" max="3600" step="1" value="5" />
          </label>

          <label>
            <span class="i18n" data-key="countdown_sound_label">Signal du compte à rebours</span>
            <select id="countdownSound">
              <option value="none"  class="i18n" data-key="cd_none">Muet</option>
              <option value="beep"  class="i18n" data-key="cd_beep" selected>Bip</option>
              <option value="voice" class="i18n" data-key="cd_voice">Voix (FR/EN)</option>
            </select>
          </label>
        </fieldset>
      </div>

      <div class="buttons">
        <button id="preset" class="ghost">
          <span class="i18n" data-key="preset">Préréglage 40 → 50 en 120 s</span>
        </button>
        <div class="spacer"></div>
        <button id="startBtn" class="primary">
          <span class="i18n" data-key="start">Démarrer</span>
        </button>
        <button id="stopBtn" class="danger" disabled>
          <span class="i18n" data-key="stop">Arrêter</span>
        </button>
      </div>

      <div class="readout">
        <div>
          <small class="muted i18n" data-key="current_bpm">Cadence actuelle (bpm)</small>
          <div id="bpmNow" class="mono big">—</div>
        </div>
        <div>
          <small class="muted i18n" data-key="status">Statut</small>
          <div id="status" class="mono">au repos</div>
        </div>
        <div>
          <small class="muted i18n" data-key="time_left">Temps restant</small>
          <div id="timeLeft" class="mono">—</div>
        </div>
      </div>

      <p class="hint" id="hintText"></p>
      <p id="iosVoiceNote" class="muted" style="display:none">⚠️ La voix du compte à rebours peut ne pas fonctionner sur iOS. Utiliser le mode « Bip ».</p>
    </section>

    <footer class="foot">
      <span class="muted">&copy; 2025 PhysioTempo</span>
    </footer>
  </main>

  <!-- Overlay compte à rebours -->
  <div id="overlay" class="overlay hidden">
    <div id="countdown" class="countdown">4</div>
  </div>

  <script src="js/app.js"></script>

  <!-- PWA: enregistrement du service worker -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("service-worker.js").catch(console.error);
      });
    }
  </script>
</body>
</html>
